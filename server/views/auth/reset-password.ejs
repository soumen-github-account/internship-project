<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reset Password</title>
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="flex pt-20 px-3 justify-center min-h-screen">

<div class="bg-slate-800 p-8 rounded-lg shadow-lg w-96 h-[300px] text-sm text-white">

  <% if (step === 'email') { %>
  <h1 class="text-2xl font-semibold text-center mb-4">Reset Password</h1>
  <p class="text-center mb-6 text-indigo-300">Enter your registered email</p>

  <form action="/auth/reset-password/email" method="POST">
    <input type="email" name="email" required
      placeholder="Email ID"
      class="w-full mb-4 px-4 py-2 rounded-full bg-[#333A5C] outline-none text-white"/>

    <button class="w-full py-2 bg-pink-600 rounded-full hover:bg-pink-700 transition">Submit</button>
  </form>
  <% } %>

  <% if (step === 'otp') { %>

  <h1 class="text-2xl font-semibold text-center mb-4">Enter OTP</h1>
  <p class="text-center mb-6 text-indigo-300">6-digit code sent to your email</p>

  <form action="/auth/reset-password/otp" method="POST" id="otpForm">
    <input type="hidden" name="otp" id="otpValue"/>
    
    <div class="flex justify-between mb-6">
      <% for(let i=0;i<6;i++){ %>
        <input type="text" maxlength="1" required
          class="otp w-12 h-12 text-center text-xl bg-[#333A5C] rounded-md outline-none text-white"/>
      <% } %>
    </div>

    <button class="w-full py-2 bg-pink-600 rounded-full hover:bg-pink-700 transition">Submit</button>
  </form>

  <p class="text-center mt-4 text-sm text-indigo-300">
    Didn't get OTP? <a href="/auth/reset-password" class="underline hover:text-indigo-400">Resend</a>
  </p>
  <% } %>

  <% if (step === 'new-password') { %>
  <h1 class="text-2xl font-semibold text-center mb-4">Set New Password</h1>
  <p class="text-center mb-6 text-indigo-300">Enter your new password</p>

  <form action="/auth/reset-password/new" method="POST">
    <input type="password" name="newPassword" required
      placeholder="New Password"
      class="w-full mb-4 px-4 py-2 rounded-full bg-[#333A5C] outline-none text-white"/>
    <button class="w-full py-2 bg-pink-600 rounded-full hover:bg-pink-700 transition">Update Password</button>
  </form>
  <% } %>

</div>

<script>
  const inputs = document.querySelectorAll(".otp");
  const otpValue = document.getElementById("otpValue");
  const otpForm = document.getElementById("otpForm");

  if(inputs.length && otpForm){
    inputs.forEach((input, index) => {
      input.addEventListener("input", () => {
        if(input.value && inputs[index+1]) inputs[index+1].focus();
        otpValue.value = [...inputs].map(i => i.value).join("");
      });
      input.addEventListener("keydown", e => {
        if(e.key === "Backspace" && !input.value && inputs[index-1]) inputs[index-1].focus();
      });
    });

    otpForm.addEventListener("submit", () => {
      otpValue.value = [...inputs].map(i => i.value).join("");
    });

    otpForm.addEventListener("paste", (e) => {
      const pasteData = e.clipboardData.getData('text').trim();
      pasteData.split('').forEach((char, idx) => {
        if(inputs[idx]) inputs[idx].value = char;
      });
      otpValue.value = [...inputs].map(i => i.value).join("");
      e.preventDefault();
    });
  }
</script>

</body>
</html>
